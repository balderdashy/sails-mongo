# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#   ╔╦╗╦═╗╔═╗╦  ╦╦╔═╗ ┬ ┬┌┬┐┬                           #
#    ║ ╠╦╝╠═╣╚╗╔╝║╚═╗ └┬┘││││                           #
#  o ╩ ╩╚═╩ ╩ ╚╝ ╩╚═╝o ┴ ┴ ┴┴─┘                         #
#                                                       #
# This file configures Travis CI.                       #
# (i.e. how we run the tests... mainly)                 #
#                                                       #
# https://docs.travis-ci.com/user/customizing-the-build #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #

---
language: node_js

node_js:
  - "8"
  - "10"
  - "12"

env:
  global:
    - WATERLINE_ADAPTER_TESTS_URL=localhost/testdb
    - WATERLINE_ADAPTER_TESTS_HOST=localhost
    - WATERLINE_ADAPTER_TESTS_DATABASE=sails-mongo
    - NODE_ENV=test

  matrix:
    - MONGODB=3.4.21
    - MONGODB=3.6.13
    - MONGODB=4.0.10

cache:
  directories:
#    - "$TRAVIS_BUILD_DIR/mongodb/mongodb-linux-x86_64-${MONGODB}"
    - "$HOME/.npm"

matrix:
  fast_finish: true

install:
  - npm install
  - "$TRAVIS_BUILD_DIR/scripts/travis/install_mongodb.sh"

before_script:
  - "$TRAVIS_BUILD_DIR/scripts/travis/run_mongodb.sh"

script:
  - npm test

after_script:
  - pkill mongod

branches:
  only:
    - master
    - fix-aggregate-mongodb34
    - upgrade-mongodb-drivers

notifications:
  email:
    - ci@sailsjs.com
